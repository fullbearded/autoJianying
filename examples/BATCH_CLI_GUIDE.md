# 批量草稿复制与素材替换工具使用指南

## 工具概述

新的 `interactive_cli.py` 是一个强大的批量处理工具，支持：
- 🎯 直接展示草稿列表选择复制模版
- 📁 自动创建part1/part2/part3文件夹结构
- 🔄 组合式素材替换（每个组合使用不同的素材组合）
- 🎲 支持顺序模式和随机裂变模式
- ⚡ 批量复制草稿并自动替换对应素材

## 测试结果

根据最新测试，您的环境已准备就绪：
- ✅ 发现草稿: "阳章老师模版" (1080x1920, 40.0s, 5个视频素材)
- ✅ 素材文件夹: part1/part2/part3 各有8个.mp4文件
- ✅ 可生成8个不同的素材组合
- ✅ 视频信息自动提取功能正常

## 工作流程

### 1. 启动工具
```bash
python examples/interactive_cli.py
```

### 2. 自动流程步骤

#### 步骤一：选择复制模版草稿
工具启动后会直接显示所有可用草稿：
```
📊 找到 1 个可用草稿:

选择作为复制模版的源草稿:
  1. 阳章老师模版 (1080x1920, 40.0s, 5个视频)
  0. 退出

👉 输入选择: 1
```

#### 步骤二：设置素材文件夹
工具会自动检测并确认素材文件夹：
```
✅ 自动检测到素材文件夹: /path/to/examples/materials
📁 素材文件夹: /path/to/examples/materials
```

#### 步骤三：创建part文件夹结构并扫描素材
```
📋 创建part文件夹结构
--------------------------------------------------
📁 文件夹已存在: part1
  └── 找到 8 个.mp4文件: ['A光.mp4', 'B经.mp4', 'C武.mp4', ...]
📁 文件夹已存在: part2  
  └── 找到 8 个.mp4文件: ['A在.mp4', 'B在.mp4', 'C斧.mp4', ...]
📁 文件夹已存在: part3
  └── 找到 8 个.mp4文件: ['A和.mp4', 'B行.mp4', 'C毒.mp4', ...]
```

#### 步骤四：选择素材组合模式
```
选择素材组合模式:
  1. 顺序模式 (不重复，按文件名排序组合)
  2. 随机裂变模式 (打乱排序，随机组合)
  0. 退出

👉 输入选择: 1
```

#### 步骤五：查看生成的组合
```
🎯 生成了 8 个素材组合:
  组合 1: A光.mp4 + A在.mp4 + A和.mp4 → 光在和
  组合 2: B经.mp4 + B在.mp4 + B行.mp4 → 经在行
  组合 3: C武.mp4 + C斧.mp4 + C毒.mp4 → 武斧毒
  组合 4: D武.mp4 + D规.mp4 + D故.mp4 → 武规故
  组合 5: E狂.mp4 + E兽.mp4 + E伐.mp4 → 狂兽伐
  ...
```

#### 步骤六：确认批量处理
```
📊 将创建 8 个草稿副本

确认开始批量处理 8 个草稿? (y/n): y
```

#### 步骤七：自动批量处理
```
🔄 处理组合 1/8: {'part1': 'A光.mp4', 'part2': 'A在.mp4', 'part3': 'A和.mp4'}
  📋 复制草稿: 阳章老师模版_光在和
  🔄 替换素材...
    🔄 将用 part1/A光.mp4 替换 part1.mp4
    🔄 将用 part2/A在.mp4 替换 part2.mp4  
    🔄 将用 part3/A和.mp4 替换 part3.mp4
    ✅ 更新素材: part1.mp4 → A光.mp4
    ✅ 更新素材: part2.mp4 → A在.mp4
    ✅ 更新素材: part3.mp4 → A和.mp4
    ✅ 素材替换完成! 成功替换 3/3 个素材
  ✅ 组合 1 处理成功

🔄 处理组合 2/8: {'part1': 'B经.mp4', 'part2': 'B在.mp4', 'part3': 'B行.mp4'}
  📋 复制草稿: 阳章老师模版_经在行
  ...
```

## 素材组合模式详解

### 顺序模式
- **特点**: 按文件名排序，确保组合的一致性
- **适用场景**: 当您希望有序地使用素材时
- **组合规律**: A组合(A+A+A)、B组合(B+B+B)、C组合(C+C+C)...

### 随机裂变模式  
- **特点**: 随机打乱排序，创造意外的组合效果
- **适用场景**: 当您希望探索不同素材的搭配效果时
- **组合规律**: 随机组合，如：A+E+C、B+A+D、C+B+A...

## 素材文件夹结构

```
examples/materials/
├── part1/          # 第一部分素材
│   ├── A光.mp4
│   ├── B经.mp4
│   ├── C武.mp4
│   └── ...
├── part2/          # 第二部分素材  
│   ├── A在.mp4
│   ├── B在.mp4
│   ├── C斧.mp4
│   └── ...
└── part3/          # 第三部分素材
    ├── A和.mp4
    ├── B行.mp4
    ├── C毒.mp4
    └── ...
```

## 输出结果

### 成功处理结果
```
======================================================================
🎬 批量处理结果
======================================================================
✅ 成功处理: 8 个草稿
❌ 失败: 0 个草稿

📄 成功创建的草稿:
  • 阳章老师模版_光在和
  • 阳章老师模版_经在行
  • 阳章老师模版_武斧毒
  • 阳章老师模版_武规故
  • 阳章老师模版_狂兽伐
  • ...
```

### 草稿命名规则
```
原草稿名_汉字组合

示例：
- 阳章老师模版_光在和 (A光.mp4 + A在.mp4 + A和.mp4)
- 阳章老师模版_经在行 (B经.mp4 + B在.mp4 + B行.mp4)
- 阳章老师模版_武斧毒 (C武.mp4 + C斧.mp4 + C毒.mp4)
- 阳章老师模版_武规故 (D武.mp4 + D规.mp4 + D故.mp4)
- 阳章老师模版_狂兽伐 (E狂.mp4 + E兽.mp4 + E伐.mp4)
```

**命名特点：**
- 自动提取文件名中的汉字字符
- 将三个part的汉字连接组成草稿名称
- 如果文件名无汉字，则使用原文件名（去掉扩展名）
- 自动处理重复名称，必要时添加序号

## 技术特色

### 1. 智能素材替换
- 自动提取视频元数据（分辨率、时长）
- 直接操作 `draft_info.json` 兼容新版剪映
- 自动备份原始文件
- 完整的错误处理和回滚机制

### 2. 批量处理优化
- 并行处理多个草稿
- 实时进度显示
- 详细的成功/失败报告

### 3. 文件管理
- 自动复制素材到草稿materials目录
- 正确更新路径占位符
- 保持草稿结构完整性

## 使用建议

### 1. 素材准备
- 确保part1/part2/part3文件夹中的素材数量一致
- 使用清晰的文件命名（如A系列、B系列、C系列）
- 建议素材分辨率和源草稿匹配

### 2. 批量处理
- 首次使用建议先测试小批量（2-3个组合）
- 确保有足够的磁盘空间
- 建议在非工作时间进行大批量处理

### 3. 结果验证
- 处理完成后在剪映中打开几个草稿验证
- 检查素材是否正确替换
- 确认草稿可以正常播放

## 故障排除

### 常见问题
1. **部分part文件夹为空**: 按提示在相应文件夹中添加.mp4文件
2. **草稿复制失败**: 检查剪映版本和草稿文件夹路径
3. **素材替换失败**: 确认素材文件存在且格式正确
4. **权限问题**: 确保对草稿文件夹有读写权限

### 恢复方法
- 每次替换都会创建.backup文件
- 可以手动恢复原始的draft_info.json
- 删除失败的草稿重新处理

## 总结

这个工具为您提供了强大的批量视频制作能力：
- 一键生成多个不同素材组合的草稿
- 支持大规模内容创作需求
- 兼容新版剪映的加密限制
- 提供完整的处理报告和错误处理

现在您可以高效地制作大量使用不同素材组合的视频内容！