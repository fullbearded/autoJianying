# 交互式CLI工具使用指南

## 概述

`interactive_cli.py` 是一个基于 `simple_copy_draft.py` 重新设计的交互式命令行工具，支持剪映草稿复制和视频片段替换功能。

## 主要功能

✅ **草稿复制**: 基于成功的 simple_copy_draft.py 实现  
✅ **草稿信息读取**: 支持新版剪映的 draft_info.json  
✅ **视频片段替换**: 基于materials数据进行素材替换  
✅ **交互式界面**: 友好的菜单驱动操作  
✅ **兼容性处理**: 支持新版剪映加密问题  

## 启动工具

```bash
python examples/interactive_cli.py
```

## 主菜单功能

### 1. 选择源草稿
- 自动扫描草稿文件夹
- 显示草稿详细信息（分辨率、时长、视频数量）
- 过滤系统文件和demo草稿
- 支持返回上级菜单

**示例显示：**
```
📊 找到 3 个可用草稿:

选择要复制的源草稿:
  1. 阳章老师模版 (1080x1920, 40.0s, 5个视频)
  2. 修复后测试版本 (1080x1920, 40.0s, 5个视频)
  3. Demo完整测试版本 (1080x1920, 40.0s, 5个视频)
```

### 2. 复制草稿
- 基于 simple_copy_draft.py 的成功实现
- 自动生成目标草稿名称（支持自定义）
- 智能错误处理（处理新版剪映加密）
- 实时显示复制结果和草稿信息

**复制流程：**
1. 确认源草稿
2. 输入目标草稿名称（可使用默认）
3. 执行复制操作
4. 显示复制结果和详细信息

### 3. 设置素材文件夹
- 自动检测 examples/materials 文件夹
- 支持自定义路径
- 递归扫描视频文件（.mp4, .mov, .avi, .mkv）
- 显示文件数量和大小信息

**自动检测路径：**
- `examples/materials/`
- `materials/`
- 当前目录下的 `materials/`

### 4. 替换视频素材
- 基于 draft_info.json 解析视频素材
- 显示原始素材详细信息
- 逐一配置替换映射
- 支持跳过特定素材
- 提供替换计划预览

**替换流程：**
1. 解析复制草稿中的视频素材
2. 显示可用的替换文件
3. 为每个视频素材配置替换
4. 执行替换（支持兼容版本）
5. 显示替换结果

### 5. 查看草稿信息
- 显示源草稿和复制草稿信息
- 完整的草稿元数据
- 视频素材详细信息
- 轨道和素材统计

**信息包含：**
- 📐 分辨率和宽高比
- ⏱️ 时长和帧率
- 🎞️ 轨道统计
- 📦 素材统计
- 🎥 视频素材详情

### 6. 设置路径
- 配置草稿文件夹路径
- 验证路径有效性
- 初始化 DraftFolder 对象

## 使用示例

### 完整工作流程

1. **启动工具**
   ```bash
   python examples/interactive_cli.py
   ```

2. **选择源草稿**
   - 选择菜单项 `1. 选择源草稿`
   - 从列表中选择要复制的草稿

3. **复制草稿**
   - 选择菜单项 `2. 复制草稿`
   - 输入目标草稿名称或使用默认

4. **设置素材文件夹**
   - 选择菜单项 `3. 设置素材文件夹`
   - 确认自动检测的路径或输入自定义路径

5. **替换视频素材**
   - 选择菜单项 `4. 替换视频素材`
   - 为每个视频配置替换文件
   - 确认替换计划并执行

6. **查看结果**
   - 选择菜单项 `5. 查看草稿信息`
   - 验证复制和替换结果

## 状态显示

工具会实时显示当前操作状态：

```
📊 当前状态:
  • 源草稿: 阳章老师模版
  • 复制草稿: 阳章老师模版_复制版_1755314123
  • 素材文件夹: materials
```

## 兼容性说明

### 新版剪映支持
- ✅ **草稿复制**: 完全支持（基于文件夹复制）
- ✅ **信息读取**: 支持 draft_info.json
- ⚠️ **素材替换**: 受限于加密（提供手动指导）

### 旧版剪映支持  
- ✅ **草稿复制**: 完全支持
- ✅ **信息读取**: 支持 draft_content.json
- ✅ **素材替换**: 完全支持自动替换

## 错误处理

### 常见问题及解决方案

**1. 草稿文件夹不存在**
```
❌ 草稿文件夹不存在!
```
- 解决：选择 `6. 设置路径` 配置正确路径

**2. API报错但草稿创建成功**
```
⚠️ 模板复制API可能报错，这是正常的（新版剪映加密）
✅ 草稿复制成功!
```
- 说明：这是正常现象，草稿已成功创建

**3. 无法读取草稿信息**
```
❌ 无法读取草稿信息
```
- 可能原因：草稿损坏或版本不兼容
- 解决：尝试其他草稿或检查草稿文件

**4. 素材替换失败**
```
⚠️ 无法加载草稿进行替换 (可能是版本不兼容)
```
- 说明：新版剪映加密限制
- 解决：按提示手动替换或使用兼容版本

## 最佳实践

### 1. 准备工作
- 确保草稿文件夹路径正确
- 准备好替换素材文件
- 建议先测试一个简单草稿

### 2. 素材管理
- 将替换素材放在 `examples/materials/` 目录
- 使用清晰的文件命名
- 确保视频格式兼容

### 3. 工作流程
- 按顺序操作：选择 → 复制 → 设置素材 → 替换
- 及时查看草稿信息验证结果
- 保留原始草稿作为备份

### 4. 故障排除
- 查看详细错误信息
- 检查文件权限
- 验证剪映版本兼容性

## 高级功能

### 批量处理建议
虽然工具目前是单草稿处理，但可以：
1. 多次运行工具处理不同草稿
2. 使用相同的素材文件夹处理多个项目
3. 创建素材替换模板（手动记录替换映射）

### 自动化脚本
可以基于此工具开发自动化脚本：
```python
from interactive_cli import InteractiveDraftCLI

cli = InteractiveDraftCLI()
# 自定义自动化逻辑
```

## 注意事项

⚠️ **重要提醒**：
- 操作前请备份重要草稿
- 新版剪映素材替换功能受限
- 大型草稿复制需要更多时间
- 确保有足够的磁盘空间

💡 **建议**：
- 首次使用建议测试小草稿
- 记录成功的替换配置供后续使用
- 定期清理生成的复制草稿