# 📁 目录文件说明

本目录包含了 pyJianYingDraft 批量素材替换系统的所有组件和工具。

## 📋 文件列表概览

```
test/
├── 📄 主要脚本 (13个)
├── 📁 配置系统 (config/)
├── 📁 素材文件夹 (materials/)
├── 📄 文档文件 (5个)
└── 📄 说明文件 (1个)
```

---

## 🎬 主要脚本文件

### 1. 核心批量替换脚本

#### `batch_replace_materials.py`
**用途**: 基础批量素材替换系统（原始版本）
**使用方法**:
```bash
python batch_replace_materials.py
```
**功能**:
- 基于"4翰墨书院模版"进行批量素材替换
- 支持图片、视频、混合三种媒体类型
- 默认使用视频模式
- 需要在代码中修改路径和参数

**适用场景**: 简单的批量替换需求，开发测试

---

#### `config_batch_replace.py` ⭐ **推荐**
**用途**: 基于配置文件的批量素材替换系统
**使用方法**:
```bash
python config_batch_replace.py
```
**功能**:
- 从 JSON 配置文件读取所有设置
- 无需修改代码即可调整参数
- 支持配置验证和详细的错误提示
- 显示完整的配置信息

**适用场景**: 生产环境使用，推荐的主要使用方式

---

#### `interactive_batch_replace.py`
**用途**: 交互式批量素材替换
**使用方法**:
```bash
python interactive_batch_replace.py
```
**功能**:
- 提供媒体类型选择菜单
- 根据选择显示相应的文件夹结构指南
- 展示不同模式的使用场景
- 交互式确认和错误处理

**适用场景**: 需要临时调整参数或新用户学习使用

---

### 2. 配置管理脚本

#### `config_manager.py`
**用途**: 配置管理器，管理系统的所有配置选项
**使用方法**:
```bash
python config_manager.py
```
**功能**:
- 加载和保存 JSON 配置文件
- 提供配置的读取、修改和验证功能
- 支持路径验证和配置摘要显示
- 可作为其他脚本的配置后端

**适用场景**: 查看当前配置状态，编程时的配置管理

---

#### `config_editor.py` ⭐ **推荐配置编辑**
**用途**: 交互式配置编辑器
**使用方法**:
```bash
python config_editor.py
```
**功能**:
- 提供友好的菜单界面
- 支持编辑路径、替换设置、模板配置等
- 实时验证配置有效性
- 支持配置保存和重置

**菜单选项**:
1. 查看当前配置
2. 编辑路径配置
3. 编辑替换设置
4. 编辑模板配置
5. 编辑高级设置
6. 验证配置
7. 保存配置
8. 重置为默认配置

**适用场景**: 首次使用时配置系统，调整系统参数

---

### 3. 文件夹和素材管理脚本

#### `setup_materials_folder.py`
**用途**: 创建批量素材替换所需的文件夹结构
**使用方法**:
```bash
python setup_materials_folder.py
```
**功能**:
- 自动创建 materials/ 文件夹及子文件夹结构
- 为每个文件夹生成使用说明
- 检查现有文件数量和类型
- 预估可生成的草稿数量

**创建的结构**:
```
materials/
├── background/     (放入 .jpg 背景图片)
├── part1/          (放入媒体文件)
├── part2/          (放入媒体文件)
└── part3/          (放入媒体文件)
```

**适用场景**: 初次使用系统时创建文件夹结构

---

#### `list_drafts.py`
**用途**: 获取并显示剪映草稿文件夹中的所有草稿列表
**使用方法**:
```bash
python list_drafts.py
```
**功能**:
- 列出所有找到的草稿名称，按编号排序显示
- 显示草稿总数和详细列表
- 如果路径不存在会显示错误信息

**输出示例**:
```
草稿文件夹路径: /Users/.../com.lveditor.draft
找到 18 个草稿:
--------------------------------------------------
 1. 花枝秋实
 2. 8月13日
 3. 老悦娃子
```

**适用场景**: 查看可用的草稿模板，确认模板名称

---

### 4. 草稿分析脚本

#### `inspect_draft.py`
**用途**: 读取指定草稿并获取详细的元素信息（适用于标准草稿）
**使用方法**:
```bash
python inspect_draft.py
```
**功能**:
- 分析草稿的基本信息（时长等）
- 提取素材元数据（贴纸、花字效果的resource_id等）
- 统计各类轨道数量和片段数量
- 仅支持剪映5.9及以下版本的未加密草稿

**适用场景**: 分析简单草稿结构，提取素材信息

---

#### `inspect_complex_draft.py`
**用途**: 分析复合草稿结构（适用于模板草稿和复杂项目）
**使用方法**:
```bash
python inspect_complex_draft.py
```
**功能**:
- 分析草稿的文件结构
- 读取草稿基本信息和模板信息
- 分析子草稿（subdraft）的内容
- 适用于有多个子草稿的复杂模板

**输出示例**:
```
📁 草稿文件结构分析:
✅ draft_info.json
✅ template.json
✅ materials/ 文件夹
✅ subdraft/ 文件夹: 28 个子草稿
```

**适用场景**: 分析复杂的模板草稿，了解项目结构

---

#### `inspect_materials.py`
**用途**: 详细分析草稿中的材料文件和资源文件
**使用方法**:
```bash
python inspect_materials.py
```
**功能**:
- 分析 materials/ 文件夹中的所有媒体文件
- 显示文件大小、类型和数量统计
- 分析 Resources/ 文件夹结构
- 提供文件类型和大小的统计信息

**输出示例**:
```
📁 Materials 文件夹详细信息:
materials/
  video/
    📄 part1.mp4 (13.4 MB) .mp4
    📄 background.jpg (556.1 KB) .jpg
  audio/
    📄 voice.mp3 (382.4 KB) .mp3
```

**适用场景**: 了解模板草稿中包含的素材，评估替换需求

---

### 5. 测试和演示脚本

#### `test_media_types.py`
**用途**: 测试不同媒体类型功能，验证图片、视频和混合模式
**使用方法**:
```bash
python test_media_types.py
```
**功能**:
- 测试图片模式（仅处理图片文件）
- 测试视频模式（仅处理视频文件）
- 测试混合模式（图片和视频混合）
- 验证文件格式识别和组合生成
- 自动创建测试素材并清理

**适用场景**: 验证系统功能，开发测试

---

#### `test_unlimited_parts.py`
**用途**: 测试无限制part文件夹功能
**使用方法**:
```bash
python test_unlimited_parts.py
```
**功能**:
- 创建包含5个part文件夹的测试结构
- 验证文件夹验证功能
- 测试材料文件获取和组合生成
- 展示超出原有3个part限制的能力

**适用场景**: 测试扩展功能，验证多part文件夹支持

---

#### `demo_batch_replace.py`
**用途**: 批量素材替换演示脚本
**使用方法**:
```bash
python demo_batch_replace.py
```
**功能**:
- 交互式演示批量替换功能
- 自动创建示例素材文件用于测试
- 展示完整的使用流程
- 提供清理功能

**适用场景**: 学习和演示系统功能，快速体验

---

## 📁 目录结构

### `config/` 配置目录
```
config/
├── settings.json       # 主配置文件
└── README.md          # 配置说明文档
```

#### `config/settings.json` ⭐ **核心配置文件**
**用途**: 系统的主要配置文件
**内容结构**:
- **paths**: 路径配置（草稿文件夹、素材文件夹）
- **template**: 模板配置（模板名称、素材映射）
- **replacement_settings**: 替换设置（媒体类型、播放速度等）
- **advanced_settings**: 高级设置（时长、格式支持）
- **ui_settings**: 界面设置（语言、进度显示）
- **metadata**: 版本信息

**编辑方法**:
1. 使用 `config_editor.py` 交互式编辑（推荐）
2. 直接编辑 JSON 文件（需要注意语法）

---

#### `config/README.md`
**用途**: 配置文件的详细说明文档
**内容**:
- 配置文件结构说明
- 各配置项的详细解释
- 配置示例和最佳实践
- 常见问题和注意事项

---

### `materials/` 素材目录
```
materials/
├── background/         # 背景图片文件夹
├── part1/             # 第一部分素材
├── part2/             # 第二部分素材
└── part3/             # 第三部分素材
```

**说明**: 
- 每个子文件夹都包含 README.md 说明文件
- 根据配置的媒体类型放入相应格式的文件
- 支持扩展更多 part 文件夹（part4, part5...）

---

## 📄 文档文件

### `README.md` ⭐ **主要说明文档**
**用途**: 项目的主要说明文档
**内容**:
- 所有脚本的详细使用说明
- 功能特性介绍
- 使用流程指导
- 常见问题解答

---

### `FEATURES.md`
**用途**: 无限制版本的功能特性说明
**内容**:
- 无限制版本的主要改进
- 技术实现细节
- 使用场景示例
- 兼容性保证

---

### `MEDIA_TYPES.md`
**用途**: 媒体类型功能的详细说明
**内容**:
- 三种媒体类型的详细介绍
- 技术实现方案
- 使用场景和建议
- 配置方法和注意事项

---

### `DIRECTORY_GUIDE.md`（本文件）
**用途**: 目录文件说明文档
**内容**:
- 所有文件的详细说明
- 使用方法和适用场景
- 文件关系和推荐使用流程

---

## 🚀 推荐使用流程

### 首次使用
1. **配置系统**: `python config_editor.py`
   - 设置草稿文件夹路径
   - 设置素材文件夹路径
   - 选择媒体类型

2. **创建文件夹**: `python setup_materials_folder.py`
   - 创建标准的素材文件夹结构

3. **添加素材**: 手动将素材文件放入相应文件夹

4. **执行替换**: `python config_batch_replace.py`

### 日常使用
1. **查看配置**: `python config_manager.py`
2. **执行替换**: `python config_batch_replace.py`

### 开发和测试
1. **功能测试**: `python test_media_types.py`
2. **演示功能**: `python demo_batch_replace.py`
3. **分析草稿**: `python inspect_complex_draft.py`

### 交互式使用
1. **配置编辑**: `python config_editor.py`
2. **交互替换**: `python interactive_batch_replace.py`

---

## ⚠️ 注意事项

1. **路径设置**: 确保配置文件中的路径正确且存在
2. **文件格式**: 注意媒体类型设置与实际文件格式的匹配
3. **权限问题**: 确保对草稿文件夹有读写权限
4. **版本兼容**: 模板模式仅支持剪映5.9及以下版本
5. **备份配置**: 修改配置前建议备份原配置文件

---

## 🆘 故障排除

### 常见问题
1. **配置文件不存在**: 运行 `python config_manager.py` 会自动创建
2. **路径不存在**: 使用 `config_editor.py` 重新设置路径
3. **草稿找不到**: 运行 `python list_drafts.py` 检查可用草稿
4. **素材文件夹为空**: 运行 `python setup_materials_folder.py` 重新创建

### 获取帮助
1. 查看相关文档文件
2. 运行测试脚本验证功能
3. 使用演示脚本学习使用方法

---

**最后更新**: 2024-12-20
**版本**: 1.0.0